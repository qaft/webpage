<!DOCTYPE html>
<html lang="en">
  <head>
    <base href="./">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <meta name="description" content="QAFT - Control Panel">
    <meta name="author" content="Łukasz Holeczek">
    <meta name="keyword" content="Bootstrap,Admin,Template,Open,Source,jQuery,CSS,HTML,RWD,Dashboard">
    <title>QAFT</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="apple-touch-icon" sizes="57x57" href="assets/favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="assets/favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="assets/favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="assets/favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="assets/favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="assets/favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="assets/favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="assets/favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="assets/favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="assets/favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="assets/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/favicon/favicon-16x16.png">
    <link rel="manifest" href="assets/favicon/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="assets/favicon/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <!-- Main styles for this application-->
    <link href="css/style.css" rel="stylesheet">
    <!-- Global site tag (gtag.js) - Google Analytics-->
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-118965717-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];

      function gtag() {
        dataLayer.push(arguments);
      }
      gtag('js', new Date());
      // Shared ID
      gtag('config', 'UA-118965717-3');
      // Bootstrap ID
      gtag('config', 'UA-118965717-5');
    </script>
    <link href="vendors/@coreui/chartjs/css/coreui-chartjs.css" rel="stylesheet">
    <style>
      #mydiv {
        position: absolute;
        z-index: 4;
        text-align: center;
        top: 160px;
        left: 300px;
        display: none;
      }

      #mydivheader {
        background-image: url(assets/img/2ipust.png);
        background-repeat: no-repeat;
        z-index: 5;
        height: 55px;
        top: -52px;
        right: -30px;
        width: 400px;
        margin: 0 auto 30px;
        position: absolute;
        padding: 10px;
        cursor: move;
      }


      #mydivheader2 {
        background-image: url(assets/img/2ipsol.png);
        background-repeat: no-repeat;
        z-index: 22;
        height: 746px;
        top: 1px;
        right: 345px;
        width: 25px;
        /* margin: 0 auto 30px; */
        position: absolute;
        /* padding: 10px; */
        cursor: move;
      }

      #mydivheader3 {
        background-image: url(assets/img/2ipsag.png);
        background-repeat: no-repeat;
        z-index: 22;
        height: 746px;
        top: 1px;
        right: -31px;
        width: 31px;
        /* margin: 0 auto 30px; */
        position: absolute;
        /* padding: 10px; */
        cursor: move;
      }

      #mydivheader4 {
        background-image: url(assets/img/2ipalt.png);
        background-repeat: no-repeat;
        z-index: 22;
        height: 65px;
        top: 676px;
        right: 0px;
        width: 345px;
        margin: 0 auto 30px;
        position: absolute;
        padding: 10px;
        pointer-events: none
      }
    </style>
  </head>



  <body class="c-app" onload="pageOnCreate()">
    <div id="mydiv" style="top: 160px; left: 300px;">

      <iframe src="https://qaft-c9c5e.web.app/" height="719" width="345" title="Iframe Example" style="border:none;background: #f2f2f2"></iframe>
      <div id="mydivheader"></div>
      <div id="mydivheader2"></div>
      <div id="mydivheader3"></div>
      <div id="mydivheader4"></div>
      <svg xmlns="http://www.w3.org/2000/svg" onclick="showAndHideEmulator()" width="48" height="48" fill="currentColor" class="bi bi-x-circle" viewBox="0 0 16 16" style="    top: -43px;position: absolute;right: -80px;cursor:pointer">
        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"></path>
        <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"></path>
      </svg>


      <svg xmlns="http://www.w3.org/2000/svg" onclick="emulatorRefreshButton()" width="48" height="48" fill="currentColor" class="bi bi-x-circle" viewBox="0 0 300 300" style="    top: 4px;position: absolute;right: -80px;cursor:pointer">
        <path d="M205.213,71.476c-16.726-12.747-36.71-19.484-57.792-19.484c-52.62,0-95.43,42.81-95.43,95.43s42.81,95.43,95.43,95.43   c25.49,0,49.455-9.926,67.479-27.951c2.343-2.343,2.343-6.142,0-8.485c-2.343-2.343-6.143-2.343-8.485,0   c-15.758,15.758-36.709,24.436-58.994,24.436c-46.003,0-83.43-37.426-83.43-83.43s37.426-83.43,83.43-83.43   c36.894,0,69.843,24.715,80.126,60.104c0.924,3.182,4.253,5.011,7.436,4.087c3.182-0.925,5.012-4.254,4.087-7.436   C233.422,101.308,221.398,83.809,205.213,71.476z"></path>
        <path d="M217.773,129.262c-2.344-2.343-6.143-2.343-8.485,0c-2.343,2.343-2.343,6.142,0,8.485l22.57,22.571   c1.125,1.125,2.651,1.757,4.243,1.757s3.118-0.632,4.243-1.757l22.57-22.571c2.343-2.343,2.343-6.142,0-8.485   c-2.344-2.343-6.143-2.343-8.485,0l-18.328,18.328L217.773,129.262z"></path>
      </svg>

    </div>

    <div class="c-sidebar c-sidebar-dark c-sidebar-fixed c-sidebar-lg-show" id="sidebar">
      <div class="c-sidebar-brand d-lg-down-none">
        <!--<svg class="c-sidebar-brand-full" width="118" height="46" alt="QAFT Logo">
        <use xlink:href="assets/brand/coreui.svg#full"></use>
      </svg>
      <svg class="c-sidebar-brand-minimized" width="46" height="46" alt="CoreUI Logo">
        <use xlink:href="assets/brand/coreui.svg#signet"></use>
      </svg>-->
        <img src="assets/img/qaftWT.png" alt="QAFT" width="90" height="46">
      </div>
      <ul class="c-sidebar-nav">
        <li class="c-sidebar-nav-item"><a class="c-sidebar-nav-link" href="index.html">
            <svg class="c-sidebar-nav-icon">
              <use xlink:href="vendors/@coreui/icons/svg/free.svg#cil-library"></use>
            </svg> Products
            <!--<span class="badge badge-info">NEW</span>-->
          </a></li>
        <!--<li class="c-sidebar-nav-title">CONTROL</li>-->
        <li class="c-sidebar-nav-item"><a class="c-sidebar-nav-link" href="product.html">
            <svg class="c-sidebar-nav-icon">
              <use xlink:href="vendors/@coreui/icons/svg/free.svg#cil-library-add"></use>
            </svg> Add Product</a></li>
        <li class="c-sidebar-nav-item"><a class="c-sidebar-nav-link" href="collections.html">
            <svg class="c-sidebar-nav-icon">
              <use xlink:href="vendors/@coreui/icons/svg/free.svg#cil-layers"></use>
            </svg> Collections</a></li>
        <li class="c-sidebar-nav-item"><a class="c-sidebar-nav-link" href="categories.html">
            <svg class="c-sidebar-nav-icon">
              <use xlink:href="vendors/@coreui/icons/svg/free.svg#cil-sitemap"></use>
            </svg> Categories Settings</a></li>
        <li class="c-sidebar-nav-item"><a class="c-sidebar-nav-link" href="homeView.html">
            <svg class="c-sidebar-nav-icon">
              <use xlink:href="vendors/@coreui/icons/svg/free.svg#cil-home"></use>
            </svg> Home View Settings</a></li>
        <li class="c-sidebar-nav-item"><a class="c-sidebar-nav-link" href="notifications.html">
            <svg class="c-sidebar-nav-icon">
              <use xlink:href="vendors/@coreui/icons/svg/free.svg#cil-bell"></use>
            </svg> Send Notifications</a></li>

        <li class="c-sidebar-nav-item mt-auto"><a class="c-sidebar-nav-link c-sidebar-nav-link-success" style="cursor: pointer;" onclick="showAndHideEmulator()" target="_top">
            <svg class="c-sidebar-nav-icon">
              <use xlink:href="vendors/@coreui/icons/svg/free.svg#cil-screen-smartphone"></use>
            </svg> Live test</a></li>
      </ul>
      <button class="c-sidebar-minimizer c-class-toggler" type="button" data-target="_parent" data-class="c-sidebar-minimized"></button>
    </div>
    <div class="c-wrapper c-fixed-components">
      <header class="c-header c-header-light c-header-fixed c-header-with-subheader">
        <button class="c-header-toggler c-class-toggler d-lg-none mfe-auto" type="button" data-target="#sidebar" data-class="c-sidebar-show">
          <svg class="c-icon c-icon-lg">
            <use xlink:href="vendors/@coreui/icons/svg/free.svg#cil-menu"></use>
          </svg>
        </button><a class="c-header-brand d-lg-none" href="#">
          <img src="assets/img/qaftWT.png" alt="QAFT" width="90" height="46"></a>
        <div class="text-value-lg"></div>
        <button class="c-header-toggler c-class-toggler mfs-3 d-md-down-none" type="button" data-target="#sidebar" data-class="c-sidebar-lg-show" responsive="true">
          <svg class="c-icon c-icon-lg">
            <use xlink:href="vendors/@coreui/icons/svg/free.svg#cil-menu"></use>
          </svg>
        </button>
        <ul class="c-header-nav d-md-down-none">
          <li class="c-header-nav-item px-3"><a class="c-header-nav-link" href="#">Dashboard</a></li>
          <!--<li class="c-header-nav-item px-3"><a class="c-header-nav-link" href="#">Users</a></li>
        <li class="c-header-nav-item px-3"><a class="c-header-nav-link" href="#">Settings</a></li>-->
        </ul>
        <ul class="c-header-nav ml-auto mr-4">

          <!-- <li class="c-header-nav-item d-md-down-none mx-2"><a class="c-header-nav-link" href="#">
            <svg class="c-icon">
              <use xlink:href="node_modules/@coreui/icons/sprites/free.svg#cil-envelope-open"></use>
            </svg></a></li> -->
          <li class="c-header-nav-item dropdown"><a class="c-header-nav-link" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">
              <div class="c-avatar"><img class="c-avatar-img" src="" alt="" id="userImageID"></div>
            </a>
            <div class="dropdown-menu dropdown-menu-right pt-0">
              <div class="dropdown-header bg-light py-2"><strong>Account</strong></div><a class="dropdown-item" href="#">
                <svg class="c-icon mr-2">
                  <use xlink:href="vendors/@coreui/icons/svg/free.svg#cil-bell"></use>
                </svg> Updates
                <!--<span class="badge badge-info ml-auto">42</span>-->
              </a><a class="dropdown-item" href="#">
                <svg class="c-icon mr-2">
                  <use xlink:href="vendors/@coreui/icons/svg/free.svg#cil-envelope-open"></use>
                </svg> Messages
                <!--<span class="badge badge-info ml-auto">42</span>-->
              </a><a class="dropdown-item" href="#">
              </a>
              <div class="dropdown-header bg-light py-2"><strong>Settings</strong></div><a class="dropdown-item" href="#">
                <svg class="c-icon mr-2">
                  <use xlink:href="vendors/@coreui/icons/svg/free.svg#cil-user"></use>
                </svg> Profile</a><a class="dropdown-item" href="#">
                <svg class="c-icon mr-2">
                  <use xlink:href="vendors/@coreui/icons/svg/free.svg#cil-settings"></use>
                </svg> Settings</a><a class="dropdown-item" href="#">
              </a>
              <div class="dropdown-divider"></div><a class="dropdown-item" href="#">
              </a>
              <div onclick="logout()"><a class="dropdown-item" href="#">
                  <svg class="c-icon mr-2">
                    <use xlink:href="vendors/@coreui/icons/svg/free.svg#cil-account-logout">
                    </use>
                  </svg> Logout
                </a>
              </div>
            </div>
          </li>
        </ul>


      </header>
      <div class="c-body">
        <main class="c-main">
          <div class="container-fluid">


            <div class="modal fade" id="addCollectionModal" tabindex="-1" aria-labelledby="myModalLabel2" style="display: none;" aria-hidden="true">
              <div class="modal-dialog " role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h4 class="modal-title">Add Collection</h4>
                    <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                  </div>
                  <div class="modal-body">
                    <input class="form-control" id="text-input-add-collection-from-modal" type="text" name="text-input" placeholder="Collection name"> <br><input class="form-control" id="text-input-imageurl-add-collection-from-modal" type="text" name="text-input" placeholder="Image url">
                  </div>
                  <div class="modal-footer">
                    <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
                    <button class="btn btn-primary" type="button" data-dismiss="modal" onclick="addCollection()">Add</button>
                  </div>
                </div>
              </div>
            </div>

            <div class="fade-in">

              <!-- Start row -->
              <div class="row">
                <div class="col-lg-6">
                  <div class="card">
                    <div class="card-header"> Categories</div>



                    <div class="card-body">



                      <div class="list-group" id="collectionList-tab" role="tablist">





                      </div>



                    </div>

                  </div>
                  <div class="card">
                    <div class="card m-b-30">
                      <div class="card-header">
                        <h5 class="card-title">Collection Settings</h5>
                      </div>
                      <div class="card-body">
                        <div class="row">
                          <div class="col-sm-8">
                            <input class="form-control" type="text" placeholder="Enter new collection name" id="collectionNameTextbox">
                          </div>
                          <div class="col-sm-4">
                            <button class="btn btn-block btn-primary" type="button" onclick="changeCollectionName()">Change</button>
                          </div>

                        </div>
                        <br>
                        <div class="row">

                          <div class="card-body col-lg-6 col-xl-6">
                            <br>
                            <input class="form-control" id="imageUrlTextBox" type="text" placeholder="Enter new image url">
                            <div class="col-6 col-sm-4 col-md-2 col-xl mb-3 mb-xl-0">
                              <br>
                              <button class="btn btn-block btn-secondary" type="button" onclick="addImage()">Add
                                Image</button>

                            </div>

                          </div>
                          <div class="col-lg-4">
                            <div id="imageSliderId">
                            </div>

                          </div>
                        </div>
                      </div>
                    </div>


                  </div>
                </div>

                <div class="col-lg-6">
                  <div class="card m-b-30">

                    <div class="card-body">
                      <div class="table-responsive">
                        <div class="row">

                          <!--
                            <div class="form-group col-sm-4">
                              <button class="btn btn-secondary dropdown-toggle" id="dropdownMenuButtonOrder" type="button"
                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Order</button>
                              <div class="dropdown-menu" aria-labelledby="dropdownMenuButton" style="margin: 0px;">
                                <a class="dropdown-item" id="orderDropdown1" onclick="isDescendingSetter(false,'dropdownMenuButtonOrder','Name Ascending')">Name Ascending</a>
                                <a class="dropdown-item" id="orderDropdown2" onclick="isDescendingSetter(true,'dropdownMenuButtonOrder','Name Descending')">Name Descending</a>
                                <a class="dropdown-item" id="orderDropdown3" onclick="isDescendingSetter(true,'dropdownMenuButtonOrder','Price Descending')">Price Descending</a>
                                <a class="dropdown-item" id="orderDropdown3" onclick="isDescendingSetter(false,'dropdownMenuButtonOrder','Price Ascending')">Price Ascending</a>
                              </div>
                            </div>-->
                        </div>
                        <table class="table table-borderless">


                          <thead>
                            <tr>
                              <th></th>
                              <th>Photo</th>
                              <th>Name</th>
                              <th>Category</th>
                              <th>Subcategory</th>
                              <th>
                                <button class="btn btn-outline-danger" type="button" onclick="deleteProcutsFromCollection()"><i class="fa fa-trash"></i></button>
                              </th>
                            </tr>
                          </thead>
                          <tbody id="elementsListID">


                          </tbody>

                        </table>
                        <nav aria-label="..." style="display: inline-block;">
                          <ul class="pagination" id="paginationBar">

                          </ul>
                        </nav>
                      </div>
                    </div>
                  </div>

                </div>
                <!-- Start col -->

                <!-- End col -->
              </div>
              <!-- End row -->
            </div>

            <!-- /.col-->
          </div>
          <!-- /.row-->
        </main>
      </div>


      <footer class="c-footer">
        <div><a href="https://qaft.uk">QAFT</a> © 2021</div>
        <div class="ml-auto">Powered by&nbsp;<a href="https://qaft.uk/">QAFT</a></div>
      </footer>
    </div>


    <!-- CoreUI and necessary plugins-->
    <script src="vendors/@coreui/coreui/js/coreui.bundle.min.js"></script>
    <!--[if IE]><!-->
    <script src="vendors/@coreui/icons/js/svgxuse.min.js"></script>
    <!--<![endif]-->
    <!-- Plugins and scripts required by this view-->
    <script src="vendors/@coreui/chartjs/js/coreui-chartjs.bundle.js"></script>
    <script src="vendors/@coreui/utils/js/coreui-utils.js"></script>
    <script src="js/main.js"></script>
    <script src="js/globals.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.3/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.6.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.3/firebase-firestore.js"></script>

    <script>
      var paginationCurrent = 1;
      var onePageItemCount = 20;
      var category_tree;
      var isDescending = false;
      var image
      var selectedCol;

      var products = [];
      var collections = {};

      var onDeleteProductIDs = [];

      document.getElementById('userImageID').src = sessionStorage.getItem('userImageUrl');
      var firebaseConfig = {
        apiKey: "AIzaSyCpOsOj0vBMsT7hCvb8f9sEW_3jxDp_jOg",
        authDomain: "qaft-c9c5e.firebaseapp.com",
        projectId: "qaft-c9c5e",
        storageBucket: "qaft-c9c5e.appspot.com",
        messagingSenderId: "804490154290",
        appId: "1:804490154290:web:f5796a39e7cf9d7bc5472b",
        measurementId: "G-7NP0C30XXD"
      };

      // Initialize Firebase
      var defaultProject = firebase.initializeApp(firebaseConfig);


      const db = firebase.firestore()
      const auth = firebase.auth()

      function pageOnCreate() {

        if (!auth.currentUser) {
          //window.location.replace('login.html')
        }

        auth.onAuthStateChanged(function(user) {
          if (user) {

          } else {
            window.location.replace('login.html')
          }
        });

        console.log(sessionStorage.getItem('storeId'))

        db.collection('qaft').doc(sessionStorage.getItem('storeId')).collection('common').doc('category_tree').get().then((catTree) => {
          category_tree = catTree.data();
          //console.log(category_tree)

        })

        db.collection('qaft').doc(sessionStorage.getItem('storeId')).collection('collections').get().then((cllctns) => {


          var inToHtml = ''
          var inToHtmlColListTab = ''

          cllctns.docs.forEach((a) => {

            collections[a.id] = (a.data());
            inToHtml = inToHtml + `<li><a class="small" data-value="option1"
                        style="display: block;padding: 3px 20px;clear: both;font-weight: 400;line-height: 1.42857143;color: #333;white-space: nowrap;"
                        tabIndex="-1"><input type="checkbox" id="checkbox_${a.id}" />&nbsp;${a.data().name}</a></li>`

            inToHtmlColListTab = inToHtmlColListTab + `<a class="list-group-item list-group-item-action justify-content-between align-items-center d-flex"
                      id="list-tab_${a.id}" data-toggle="tab" role="tab" aria-controls="list-${a.id}"
                      aria-selected="false" onclick="selectCol('${a.id}')">${a.data().name}</a>`

          })

          inToHtmlColListTab = inToHtmlColListTab + `<a class="justify-content-center list-group-item list-group-item-action align-items-center d-flex" id="list-settings-list" data-target="#addCollectionModal" data-toggle="modal" href="#list-settings" role="tab" aria-controls="list-settings" style="justify-content:center">Add collection</a>`


          inToHtm = inToHtml + `<button class="btn btn-block btn-primary" type="button" onclick="saveToCollections()">Add to collection</button>`


          document.getElementById('collectionList-tab').innerHTML = inToHtmlColListTab
        })
      }



      function selectCol(colId) {
        selectedCol = colId;
        products = []
        if (collections[colId].products.length == 0) {
          loadProducts(paginationCurrent)
          document.getElementById('collectionNameTextbox').value = ''
          image = ''
          document.getElementById('imageUrlTextBox').value = image
          setSlidenImages();

        }

        document.getElementById('collectionNameTextbox').value = collections[selectedCol].name
        image = collections[selectedCol].imageUrl
        document.getElementById('imageUrlTextBox').value = image
        collections[colId].products.forEach((m) => {

          m.get().then((a) => {

            var tmpp = a.data()
            tmpp.id = a.id
            products.push(tmpp)
            loadProducts(paginationCurrent)

            setSlidenImages();
          })

        })

      }

      function addImage() {
        if (document.getElementById('imageUrlTextBox').value == '') {
          return;
        }

        image = document.getElementById('imageUrlTextBox').value;
        //document.getElementById('imageUrlTextBox').value = ''

        db.collection('qaft').doc(sessionStorage.getItem('storeId')).collection('collections').doc(selectedCol).set({
          imageUrl: image
        }, {
          merge: true
        }).then((all) => {

        })

        setSlidenImages();
      }

      function setSlidenImages() {

        var imgsInHtml2 = '';


        var template2 = `<img class="w-100 p-3" src="${image}">`;


        imgsInHtml2 = imgsInHtml2 + template2;


        //document.getElementById('imageSliderId').innerHTML = imgsInHtml
        document.getElementById('imageSliderId').innerHTML = imgsInHtml2


      }

      function getProductsFromFB(catSubCatKey, orderByKey, isDesc, isSubcat) {


        if (isDesc) {
          if (isSubcat) {
            db.collection('qaft').doc(sessionStorage.getItem('storeId')).collection('products').where('sub_category', "==", catSubCatKey).orderBy(orderByKey, 'desc').get().then((all) => {

              products = []
              for (i = 0; i < all.docs.length; i++) {
                var tmpJs = all.docs[i].data()
                tmpJs.id = all.docs[i].id
                products.push(tmpJs);
              }

              loadProducts(paginationCurrent);
            })
          } else {
            db.collection('qaft').doc(sessionStorage.getItem('storeId')).collection('products').where('category', "==", catSubCatKey).orderBy(orderByKey, 'desc').get().then((all) => {

              products = []
              for (i = 0; i < all.docs.length; i++) {
                var tmpJs = all.docs[i].data()
                tmpJs.id = all.docs[i].id
                products.push(tmpJs);
              }

              loadProducts(paginationCurrent);
            })
          }
        } else {
          if (isSubcat) {
            db.collection('qaft').doc(sessionStorage.getItem('storeId')).collection('products').where('sub_category', "==", catSubCatKey).orderBy(orderByKey).get().then((all) => {

              products = []
              for (i = 0; i < all.docs.length; i++) {
                var tmpJs = all.docs[i].data()
                tmpJs.id = all.docs[i].id
                products.push(tmpJs);
              }

              loadProducts(paginationCurrent);
            })
          } else {
            db.collection('qaft').doc(sessionStorage.getItem('storeId')).collection('products').where('category', "==", catSubCatKey).orderBy(orderByKey).get().then((all) => {

              products = []
              for (i = 0; i < all.docs.length; i++) {
                var tmpJs = all.docs[i].data()
                tmpJs.id = all.docs[i].id
                products.push(tmpJs);
              }

              loadProducts(paginationCurrent);
            })
          }

        }
      }

      function isDescendingSetter(isDscndng, s1, s2) {
        document.getElementById(s1).innerHTML = s2
        isDescending = isDscndng
      }



      function createSubCatDropdown(cat) {
        var inHtmlStr = '';

        category_tree[cat].forEach((a) => {
          inHtmlStr = inHtmlStr + `<a class="dropdown-item" onclick="getProductsFromFB('${a}','name',${isDescending},true);document.getElementById('dropdownMenuButtonSubCat').innerHTML='${a}'">${a}</a>`
        })
        document.getElementById('subCatDropdown').innerHTML = inHtmlStr


      }




      function createPaginationBar(lngth) {

        var allPaginationBar = `<li class="page-item disabled">
                                <span class="page-link">Previous</span>
                              </li>`;
        for (i = 1; i <= lngth / onePageItemCount + 1; i++) {
          allPaginationBar = allPaginationBar + `<li class="page-item"><a class="page-link" href="#" onclick="loadProducts(${i})">${i}</a></li>`
        }
        allPaginationBar = allPaginationBar + `
                              <li class="page-item">
                                <a class="page-link" href="#">Next</a>
                              </li>`;
        document.getElementById('paginationBar').innerHTML = allPaginationBar;
      }

      function loadProducts(page) {
        onDeleteProductIDs = []
        elmntlst = document.getElementById('elementsListID')

        var all_items = '';

        const db = firebase.firestore()
        for (i = page * onePageItemCount - onePageItemCount; i < page * onePageItemCount; i++) {
          if (i >= products.length) {
            break;
          }
          name = products[i].name
          img = products[i].imageUrls[0];
          price = products[i].price
          category = products[i].category
          subcategory = products[i].sub_category;
          old_price = products[i].old_price;
          if (old_price === 0) {
            old_price = '';
          } else {
            old_price = '$' + old_price;
          }
          sizesTmp = products[i].sizes;
          available_sizes = products[i].available_sizes;
          var sizes = [];
          if (sizesTmp.length != 1) {
            sizesTmp.forEach(element => {
              if (available_sizes.includes(element)) {
                sizes.push('<span class="badge badge-secondary-inverse" style="color:Black;background-color:#EBEDEF">' + element + '</span>')
              } else {
                sizes.push('<span class="badge badge-secondary-inverse" style="color:DarkGrey">' + element + '</span>')
              }
            });
          }

          var item = `<tr>
          <th scope="row"><input class="form-check-input" type="checkbox" onclick="checkboxChecked('${products[i].id}','flexCheckChecked_${i}')" id="flexCheckChecked_${i}" style="margin-left:0;margin-top:15px"></th>
          <td><img src="${img}" class="img-fluid" width="35" alt="product"></td>
          <td>${name}</td>
          <td>${category}</td>
          <td>${subcategory}</td>
        
        </tr>`;

          all_items = all_items + item;

        }
        elmntlst.innerHTML = all_items;

      }

      function changePaginationCount(cnt) {

        paginationCurrent = 1;
        onePageItemCount = cnt;

        createPaginationBar(products.length);

        loadProducts(paginationCurrent);

        document.getElementById('dropdownMenuButtonPagination').innerHTML = cnt;

      }



      function checkboxChecked(productId, checkBoxID) {
        //console.log(document.getElementById(checkBoxID).checked)

        if (document.getElementById(checkBoxID).checked) {
          onDeleteProductIDs.push(productId)
        } else if (!document.getElementById(checkBoxID).checked) {
          for (i in onDeleteProductIDs) {
            if (onDeleteProductIDs[i] == productId) {
              onDeleteProductIDs.splice(i, 1)
            }
          }
        }
      }



      function logout() {
        window.location.replace('login.html')
        auth.signOut().then(() => {
          window.location.replace('login.html')
        }).catch((error) => {
          window.location.replace('login.html')
        });

      }


      function editButton(data) {
        window.sessionStorage.setItem('editDataTemp', JSON.stringify(products[data]))
        console.log(JSON.parse(window.sessionStorage.getItem('editDataTemp')))
        window.location.replace('product.html')
      }

      function changeCollectionName() {
        var newName = document.getElementById('collectionNameTextbox').value;
        if (newName != '') {
          collections[selectedCol].name = newName
          db.collection('qaft').doc(sessionStorage.getItem('storeId')).collection('collections').doc(selectedCol).set({
            name: newName
          }, {
            merge: true
          }).then((catTree) => {
            document.getElementById('list-tab_' + selectedCol).innerHTML = newName + `</a>`
          });
        }
      }

      function deleteProcutsFromCollection() {

        var goToFbPrdcts = []
        var tmpProducts = []
        products.forEach((prdtc) => {
          if (!onDeleteProductIDs.includes(prdtc.id)) {

            var ref = db.collection('qaft').doc(sessionStorage.getItem('storeId')).collection('products').doc(prdtc.id)
            goToFbPrdcts.push(ref)
            tmpProducts.push(prdtc)
          }
        })
        products = tmpProducts

        var refPrdcts = []

        products.forEach((p) => {
          refPrdcts.push(db.collection('qaft').doc(sessionStorage.getItem('storeId')).collection('produtcs').doc(p.id))
        })


        collections[selectedCol].products = refPrdcts


        db.collection('qaft').doc(sessionStorage.getItem('storeId')).collection('collections').doc(selectedCol).set({
          products: goToFbPrdcts
        }, {
          merge: true
        }).then((n) => {
          loadProducts(paginationCurrent)
        })
      }


      function addCollection() {

        var colName = document.getElementById('text-input-add-collection-from-modal').value
        var colImageUrl = document.getElementById('text-input-imageurl-add-collection-from-modal').value

        if (colName == '') {
          return
        }

        if (colImageUrl == '') {
          return
        }




        db.collection('qaft').doc(sessionStorage.getItem('storeId')).collection('collections').doc().set({
          name: colName,
          imageUrl: colImageUrl,
          products: []
        }).then((a) => {
          loadProducts(paginationCurrent)
          pageOnCreate()
        })


      }
    </script>
    <script>
      //Make the DIV element draggagle:
      dragElement(document.getElementById("mydiv"));

      function dragElement(elmnt) {
        var pos1 = 0,
          pos2 = 0,
          pos3 = 0,
          pos4 = 0;
        if (document.getElementById(elmnt.id + "header")) {
          /* if present, the header is where you move the DIV from:*/
          document.getElementById(elmnt.id + "header").onmousedown = dragMouseDown;

        } else {
          /* otherwise, move the DIV from anywhere inside the DIV:*/
          elmnt.onmousedown = dragMouseDown;
        }

        function dragMouseDown(e) {
          e = e || window.event;
          e.preventDefault();
          // get the mouse cursor position at startup:
          pos3 = e.clientX;
          pos4 = e.clientY;
          document.onmouseup = closeDragElement;
          // call a function whenever the cursor moves:
          document.onmousemove = elementDrag;
        }

        function elementDrag(e) {
          e = e || window.event;
          e.preventDefault();
          // calculate the new cursor position:
          pos1 = pos3 - e.clientX;
          pos2 = pos4 - e.clientY;
          pos3 = e.clientX;
          pos4 = e.clientY;
          // set the element's new position:
          elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
          elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
        }

        function closeDragElement() {
          /* stop moving when mouse button is released:*/
          document.onmouseup = null;
          document.onmousemove = null;
        }
      }


      //Make the DIV element draggagle:
      dragElementRight(document.getElementById("mydiv"));

      function dragElementRight(elmnt) {
        var pos1 = 0,
          pos2 = 0,
          pos3 = 0,
          pos4 = 0;
        if (document.getElementById(elmnt.id + "header3")) {
          /* if present, the header is where you move the DIV from:*/
          document.getElementById(elmnt.id + "header3").onmousedown = dragMouseDown;

        } else {
          /* otherwise, move the DIV from anywhere inside the DIV:*/
          elmnt.onmousedown = dragMouseDown;
        }

        function dragMouseDown(e) {
          e = e || window.event;
          e.preventDefault();
          // get the mouse cursor position at startup:
          pos3 = e.clientX;
          pos4 = e.clientY;
          document.onmouseup = closeDragElement;
          // call a function whenever the cursor moves:
          document.onmousemove = elementDrag;
        }

        function elementDrag(e) {
          e = e || window.event;
          e.preventDefault();
          // calculate the new cursor position:
          pos1 = pos3 - e.clientX;
          pos2 = pos4 - e.clientY;
          pos3 = e.clientX;
          pos4 = e.clientY;
          // set the element's new position:
          elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
          elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
        }

        function closeDragElement() {
          /* stop moving when mouse button is released:*/
          document.onmouseup = null;
          document.onmousemove = null;
        }
      }

      //Make the DIV element draggagle:
      dragElementBottom(document.getElementById("mydiv"));

      function dragElementBottom(elmnt) {
        var pos1 = 0,
          pos2 = 0,
          pos3 = 0,
          pos4 = 0;
        if (document.getElementById(elmnt.id + "header4")) {
          /* if present, the header is where you move the DIV from:*/
          document.getElementById(elmnt.id + "header4").onmousedown = dragMouseDown;

        } else {
          /* otherwise, move the DIV from anywhere inside the DIV:*/
          elmnt.onmousedown = dragMouseDown;
        }

        function dragMouseDown(e) {
          e = e || window.event;
          e.preventDefault();
          // get the mouse cursor position at startup:
          pos3 = e.clientX;
          pos4 = e.clientY;
          document.onmouseup = closeDragElement;
          // call a function whenever the cursor moves:
          document.onmousemove = elementDrag;
        }

        function elementDrag(e) {
          e = e || window.event;
          e.preventDefault();
          // calculate the new cursor position:
          pos1 = pos3 - e.clientX;
          pos2 = pos4 - e.clientY;
          pos3 = e.clientX;
          pos4 = e.clientY;
          // set the element's new position:
          elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
          elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
        }

        function closeDragElement() {
          /* stop moving when mouse button is released:*/
          document.onmouseup = null;
          document.onmousemove = null;
        }
      }

      //Make the DIV element draggagle:
      dragElementLeft(document.getElementById("mydiv"));

      function dragElementLeft(elmnt) {
        var pos1 = 0,
          pos2 = 0,
          pos3 = 0,
          pos4 = 0;
        if (document.getElementById(elmnt.id + "header2")) {
          /* if present, the header is where you move the DIV from:*/
          document.getElementById(elmnt.id + "header2").onmousedown = dragMouseDown;

        } else {
          /* otherwise, move the DIV from anywhere inside the DIV:*/
          elmnt.onmousedown = dragMouseDown;
        }

        function dragMouseDown(e) {
          e = e || window.event;
          e.preventDefault();
          // get the mouse cursor position at startup:
          pos3 = e.clientX;
          pos4 = e.clientY;
          document.onmouseup = closeDragElement;
          // call a function whenever the cursor moves:
          document.onmousemove = elementDrag;
        }

        function elementDrag(e) {
          e = e || window.event;
          e.preventDefault();
          // calculate the new cursor position:
          pos1 = pos3 - e.clientX;
          pos2 = pos4 - e.clientY;
          pos3 = e.clientX;
          pos4 = e.clientY;
          // set the element's new position:
          elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
          elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
        }

        function closeDragElement() {
          /* stop moving when mouse button is released:*/
          document.onmouseup = null;
          document.onmousemove = null;
        }
      }
    </script>


  </body>
</html>